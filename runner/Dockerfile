FROM gitlab/gitlab-runner:latest

RUN sed -i s@/deb.debian.org/@/mirrors.aliyun.com/@g /etc/apt/sources.list
RUN apt-get clean && \
    apt-get update -y && \
    apt-get install -y vim zlib1g-dev ruby-dev gcc libffi-dev make g++ ruby ruby-dev nodejs

# 替换gem国内源
RUN gem sources --add http://gems.ruby-china.com/ --remove https://rubygems.org/ && \
    gem install bundler

RUN usermod -a -G sudo gitlab-runner

sudo visudo
gitlab-runner ALL=(ALL) NOPASSWD: ALL

# 需要把sudo group的设置也改为nopasswd 否则用户的 NOPASSWD 会被覆盖不生效